Upstream revision 11011, fixing bug 6218:
http://llvm.org/bugs/show_bug.cgi?id=6218

--- cfe/trunk/lib/Driver/Tools.cpp	2010/08/03 15:07:17	110110
+++ cfe/trunk/lib/Driver/Tools.cpp	2010/08/03 16:14:14	110111
@@ -1600,6 +1600,11 @@
          it = Args.begin(), ie = Args.end(); it != ie; ++it) {
     Arg *A = *it;
     if (A->getOption().hasForwardToGCC()) {
+      // Don't forward any -g arguments to assembly steps.
+      if (isa<AssembleJobAction>(JA) &&
+          A->getOption().matches(options::OPT_g_Group))
+        continue;
+
       // It is unfortunate that we have to claim here, as this means
       // we will basically never report anything interesting for
       // platforms using a generic gcc, even if we are just using gcc


